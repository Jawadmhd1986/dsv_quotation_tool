<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DSV Quotation Generator</title>
  <style>
    /*-----------------------------------
      Color palette
    -----------------------------------*/
    :root {
      --blue-dsv:       #002c77;
      --blue-dsv-light: #00389b;
      --white:          #ffffff;
      --grey-bg:        #f0f0f0;
      --text-dsv:       #002c77;
    }

    /*-----------------------------------
      Reset & base
    -----------------------------------*/
    *, *::before, *::after { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: var(--grey-bg);
      height: 100vh;
      overflow: hidden;
    }

    /*-----------------------------------
      Section wrapper
    -----------------------------------*/
    .quote-section {
      position: relative;
      width: 100%;
      height: 100%;
      background: var(--blue-dsv);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 2rem;
    }

    /*-----------------------------------
      Floating DSV logo
    -----------------------------------*/
    .dsv-logo {
      position: absolute;
      top: 2rem;
      left: 50%;
      transform: translateX(-50%);
      width: 140px;
    }

    /*-----------------------------------
      White card
    -----------------------------------*/
    .quote-card {
      background: var(--white);
      border-radius: 12px;
      padding: 2.5rem 2rem 1.5rem;
      width: 100%;
      max-width: 420px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      text-align: left;
    }
    .quote-card h1 {
      margin: 0 0 1.5rem;
      color: var(--text-dsv);
      font-size: 1.6rem;
      text-align: center;
    }
    .quote-card label {
      display: block;
      margin: 1rem 0 0.25rem;
      font-weight: bold;
      color: var(--text-dsv);
      font-size: 0.95rem;
    }
    .quote-card select,
    .quote-card input {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid var(--blue-dsv);
      border-radius: 6px;
      font-size: 1rem;
      color: var(--text-dsv);
    }
    .quote-card select:focus,
    .quote-card input:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(0, 56, 155, 0.3);
    }

    /* Generate button */
    .btn-generate {
      margin-top: 1.8rem;
      width: 100%;
      padding: 1rem;
      background: var(--blue-dsv);
      color: var(--white);
      border: none;
      border-radius: 6px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn-generate:hover {
      background: var(--blue-dsv-light);
    }

    /*-----------------------------------
      Chat toggle
    -----------------------------------*/
    .chat-toggle {
      position: absolute;
      bottom: 2rem;
      right: 2rem;
      background: var(--white);
      border: none;
      padding: 0.5rem;
      border-radius: 50%;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      cursor: pointer;
    }
    .chat-toggle img {
      display: block;
      width: 36px;
      height: 36px;
    }

    /*-----------------------------------
      Chat widget
    -----------------------------------*/
    .chat-box {
      position: fixed;
      bottom: 6rem;
      right: 2rem;
      width: 300px;
      max-width: 90%;
      background: var(--white);
      color: #000;
      border-radius: 10px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.2);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transform: translateY(200%);
      transition: transform 0.3s ease;
      font-family: Arial, sans-serif;
      z-index: 1000;
    }
    .chat-box.open {
      transform: translateY(0);
    }
    .chat-header {
      background: var(--blue-dsv);
      color: var(--white);
      padding: 0.8rem 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
    }
    .chat-header button {
      background: none;
      border: none;
      color: var(--white);
      font-size: 1.2rem;
      cursor: pointer;
    }
    .chat-messages {
      flex: 1;
      padding: 1rem;
      background: #f9f9f9;
      overflow-y: auto;
    }
    .message { margin-bottom: 0.8rem; clear: both; }
    .message.user .bubble {
      background: var(--blue-dsv);
      color: var(--white);
      padding: 0.5rem 0.8rem;
      border-radius: 16px 16px 4px 16px;
      float: right;
      max-width: 80%;
    }
    .message.bot .bubble {
      background: #e2e2e2;
      color: #000;
      padding: 0.5rem 0.8rem;
      border-radius: 16px 16px 16px 4px;
      float: left;
      max-width: 80%;
    }
    .chat-footer {
      display: flex;
      border-top: 1px solid #ccc;
    }
    .chat-footer input {
      flex: 1;
      border: none;
      padding: 0.6rem;
      font-size: 1rem;
    }
    .chat-footer input:focus {
      outline: none;
    }
    .chat-footer button {
      background: var(--blue-dsv);
      color: var(--white);
      border: none;
      padding: 0 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .chat-footer button:hover {
      background: var(--blue-dsv-light);
    }

    /*-----------------------------------
      Mobile adjustments
    -----------------------------------*/
    @media (max-width: 480px) {
      .dsv-logo { width: 120px; top: 1.5rem; }
      .quote-card {
        padding: 2rem 1rem 1rem;
        max-width: 320px;
      }
      .btn-generate {
        font-size: 1rem;
        padding: 0.9rem;
      }
      .chat-box {
        width: 90%;
        bottom: 5rem;
        right: 5%;
      }
    }
  </style>
</head>
<body>

  <div class="quote-section">
    <!-- Floating DSV logo -->
    <img src="static/dsv_logo.png" alt="DSV Logo" class="dsv-logo" />

    <!-- White card container -->
    <div class="quote-card">
      <h1>Quotation Generator</h1>
      <form action="/generate" method="post">
        <label for="storage">Storage Type</label>
        <select id="storage" name="storage_type" required>
          <option value="">— Select —</option>
          <option>AC</option>
          <option>Non-AC</option>
          <option>Open Shed</option>
          <option>Chemicals AC</option>
          <option>Chemicals Non-AC</option>
          <option>Open Yard – KIZAD</option>
          <option>Open Yard – Mussafah</option>
        </select>

        <label for="volume">Volume (CBM or SQM)</label>
        <input type="number" step="0.01" id="volume" name="volume" required />

        <label for="days">Duration (Days)</label>
        <input type="number" id="days" name="days" required />

        <label for="wms">Include WMS?</label>
        <select id="wms" name="wms" required>
          <option>Yes</option>
          <option>No</option>
        </select>

        <label for="email">Recipient Email (optional)</label>
        <input type="email" id="email" name="email" />

        <button type="submit" class="btn-generate">Generate Quotation</button>
      </form>
    </div>

    <!-- Chat toggle button -->
    <button class="chat-toggle"><img src="static/chat-icon.png" alt="Chat with DSV" /></button>

    <!-- Chat widget -->
    <div class="chat-box" id="chat-box">
      <div class="chat-header">
        <span>DSV Assistant</span>
        <button id="chat-close">&times;</button>
      </div>
      <div class="chat-messages" id="chat-messages"></div>
      <div class="chat-footer">
        <input id="chat-input" type="text" placeholder="Type your message…" />
        <button id="chat-send">Send</button>
      </div>
    </div>
  </div>

  <script>
    // Chat open/close
    const chatBox     = document.getElementById('chat-box');
    const chatToggle  = document.querySelector('.chat-toggle');
    const chatClose   = document.getElementById('chat-close');
    const sendBtn     = document.getElementById('chat-send');
    const inputEl     = document.getElementById('chat-input');
    const msgsEl      = document.getElementById('chat-messages');

    chatToggle.addEventListener('click', () => chatBox.classList.toggle('open'));
    chatClose.addEventListener('click', () => chatBox.classList.remove('open'));

    // Send message
    sendBtn.addEventListener('click', sendMessage);
    inputEl.addEventListener('keydown', e => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    async function sendMessage() {
      const text = inputEl.value.trim();
      if (!text) return;
      appendMessage('user', text);
      inputEl.value = '';

      try {
        const res = await fetch('/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: text })
        });
        const { reply } = await res.json();
        appendMessage('bot', reply, true);
      } catch {
        appendMessage('bot', 'Sorry, something went wrong.');
      }
    }

    function appendMessage(sender, text, typewriter = false) {
      const wrapper = document.createElement('div');
      wrapper.className = `message ${sender}`;
      const bubble = document.createElement('div');
      bubble.className = 'bubble';
      wrapper.appendChild(bubble);
      msgsEl.appendChild(wrapper);
      msgsEl.scrollTop = msgsEl.scrollHeight;

      if (!typewriter) {
        bubble.textContent = text;
      } else {
        let i = 0;
        (function typeChar() {
          if (i < text.length) {
            bubble.textContent += text.charAt(i++);
            msgsEl.scrollTop = msgsEl.scrollHeight;
            setTimeout(typeChar, 15);
          }
        })();
      }
    }
  </script>
</body>
</html>
